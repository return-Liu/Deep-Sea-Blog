import{a as i,d as Te,u as Fe,A as B,e as m,O as ne,B as Re,c as y,f as a,s as T,y as C,P as Ge,x as h,h as l,J as F,K as oe,w as _,T as He,j as Je,n as O,E as b,Q as qe,r as S,L as Qe,i as We,o as v,N as ie,z as re,q as Xe,k as R,R as G,S as V,F as H}from"./index-DaoAQrrJ.js";import{I as de,H as Ye}from"./HeartOutlined-CqtU-ya3.js";import{D as Ze}from"./DeleteOutlined-BzePei8I.js";import{f as Ke,z as et}from"./zh-CN-ZPh2jKaf.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};function ue(p){for(var o=1;o<arguments.length;o++){var u=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(u).filter(function(g){return Object.getOwnPropertyDescriptor(u,g).enumerable}))),c.forEach(function(g){st(p,g,u[g])})}return p}function st(p,o,u){return o in p?Object.defineProperty(p,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):p[o]=u,p}var J=function(o,u){var c=ue({},o,u.attrs);return i(de,ue({},c,{icon:at}),null)};J.displayName="EditOutlined";J.inheritAttrs=!1;var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"};function ce(p){for(var o=1;o<arguments.length;o++){var u=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(u).filter(function(g){return Object.getOwnPropertyDescriptor(u,g).enumerable}))),c.forEach(function(g){nt(p,g,u[g])})}return p}function nt(p,o,u){return o in p?Object.defineProperty(p,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):p[o]=u,p}var q=function(o,u){var c=ce({},o,u.attrs);return i(de,ce({},c,{icon:lt}),null)};q.displayName="EyeOutlined";q.inheritAttrs=!1;const ot={class:"share-container"},it={class:"profile-section"},rt={class:"profile-info"},ut={class:"avatar"},ct=["title"],dt={class:"user-info"},pt=["title"],vt=["title"],mt={class:"stats"},gt={class:"stat-item"},ft={class:"number"},yt={class:"stat-item"},ht={class:"number"},_t={class:"stat-item"},bt={class:"number"},kt={class:"content-nav"},Ct=["onClick"],wt={class:"icon"},xt={class:"text"},Ot={class:"content-section"},zt=["onClick","title"],$t={class:"card-media"},St={class:"card-overlay"},It={class:"date"},Pt={class:"card-content"},Et={class:"title"},Vt={class:"excerpt"},Dt={class:"card-actions"},Lt={key:0,class:"tag"},Nt={class:"action-buttons"},Ut=["onClick"],jt={class:"like-count"},Mt={class:"views-count"},At={key:0,class:"empty-state"},Bt={class:"upload-container"},Tt={key:0,class:"uploaded-image"},Ft={key:1,class:"upload-placeholder"},Rt=Te({__name:"Share",setup(p){const o=[{id:"essays",text:"博客文章",icon:"📝"},{id:"photographys",text:"摄影图库",icon:"📸"},{id:"notes",text:"随笔随记",icon:"✨"}],u=Fe(),c=B(()=>u.user),g=m(null);let N=m(!1),k=m([]),z=m([]),$=m([]),I=m(null),w=m(!1),pe=m("rtl"),s=m({size:0}),D=m({}),ve=m("");const P=m(1),E=m(10),me=B(()=>f.value==="essays"?k.value.length+z.value.length+$.value.length:f.value==="photographys"?z.value.length+k.value.length+$.value.length:f.value==="notes"?$.value.length+k.value.length+z.value.length:0),ge=()=>s.value.title!==D.value.title||s.value.content!==D.value.content||s.value.label!==D.value.label||s.value.image!==D.value.image,Q=()=>{g.value.submit()},fe=(e,t)=>{N.value=t.length>0};function ye(){O.get("/users/me").then(e=>{I.value=e.data.data.id,U()}).catch(e=>{console.log("获取信息失败")})}async function U(){try{const[e,t,r]=await Promise.all([O.get("/admin/article",{params:{userId:I.value,page:P.value,pageSize:E.value}}),O.get("/admin/photography",{params:{userId:I.value,page:P.value,pageSize:E.value}}),O.get("/admin/note",{params:{userId:I.value,page:P.value,pageSize:E.value}})]);k.value=e.data.data.articles.map(d=>({...d,type:"essay",views:d.views||0,isViewed:!1})),z.value=t.data.data.photography.map(d=>({...d,type:"photography"})),$.value=r.data.data.notes.map(d=>({...d,type:"notes"}))}catch(e){console.error("获取数据失败:",e),b.error("获取数据失败，请稍后再试")}}const he=m({notes:"随笔随记",photography:"摄影图库",essay:"博客文章"}),W=B(()=>{const e=(P.value-1)*E.value,t=e+E.value;let r=[];return f.value==="essays"?r=[...k.value,...z.value,...$.value]:f.value==="photographys"?r=[...z.value,...k.value,...$.value]:f.value==="notes"&&(r=[...$.value,...k.value,...z.value]),r.slice(e,t)}),_e=e=>{P.value=e},j=qe(),be=We(),ke=e=>{f.value=e,be.push({name:"Share",params:{tab:e}})},f=m(Array.isArray(j.params.tab)?j.params.tab[0]:j.params.tab||"essays");ne(f,()=>{P.value=1,U()}),ne(()=>j.params.tab,e=>{f.value=Array.isArray(e)?e[0]:e||"essays"});const Ce=e=>Ke(new Date(e),{addSuffix:!0,locale:et});async function we(e,t){try{const r=await O.post("/admin/likes/like",{articleId:e,userId:I.value}),d=k.value.findIndex(x=>x.id===e);d!==-1&&(k.value[d].isLiked=!t,k.value[d].likesCount=r.data.likeCount)}catch(r){console.error("点赞/取消点赞失败",r),b.error("点赞/取消点赞失败，请稍后再试")}}const xe=e=>{s.value={...e},D.value={...e},ve.value=e.type,w.value=!0};async function Oe(){try{if(ge()){const{id:e,type:t,size:r}=s.value;let d="",x={};switch(t){case"essay":d=`/admin/article/${e}`,x={title:s.value.title,content:s.value.content,label:s.value.label,image:s.value.image,size:r};break;case"photography":d=`/admin/photography/${e}`,x={image:s.value.image,size:r};break;case"notes":d=`/admin/note/${e}`,x={title:s.value.title,content:s.value.content,image:s.value.image,size:r};break}await O.put(d,x),Q(),U(),b.success("更新成功"),w.value=!1}else b.info("没有发现任何更改，请修改后再来保存"),w.value=!1}catch(e){console.error("保存失败:",e),b.error("保存失败，请检查数据格式")}}const ze=async e=>{w.value=!1,N.value=!1,e()},$e=()=>{var t;const e=(t=s.value)==null?void 0:t.id;e!==void 0?Se(e):b.error("无法获取内容 ID，请重试")};let Se=async e=>{try{let t="";switch(s.value.type){case"essay":t=`/admin/article/${e}`;break;case"photography":t=`/admin/photography/${e}`;break;case"notes":t=`/admin/note/${e}`;break}if(s.value.image){const r=s.value.image.split("/").pop();await O.delete(`/admin/upload/image/${r}`)}await O.delete(t),U(),b.success("删除成功"),w.value=!1}catch(t){console.error("删除失败",t),b.error("删除失败，请稍后再试")}};const Ie=e=>{const r=["image/jpeg","image/png","image/webp","image/gif"].includes(e.type),d=e.size/1024/1024<2;if(r||b.error("上传图片只能是 JPG 或 PNG 或 WEBP 或 GIF 格式!"),d||b.error("上传图片大小不能超过 2MB!"),!I.value)return b.error("ID未找到，请重新登录"),!1;if(s.value.size=e.size,s.value.image){const L=s.value.image.split("/").pop();O.delete(`${H}/admin/upload/image/${L}`),b.success("旧图片已删除,已重新上传新图片")}return r&&d},Pe=(e,t)=>{s.value.image=`${H}/image/${e.data.image}`,b.success("图片上传成功"),g.value.clearFiles(),N.value=!1},Ee=e=>{var t;return((t=o.find(r=>r.id===e))==null?void 0:t.text)||""},Ve=e=>(f.value==="essay",e.title),De=e=>(f.value==="essay",e.content),Le=e=>e.label,X=e=>e.isLiked,Ne=e=>e.likesCount;return Re(()=>{ye()}),(e,t)=>{var Y,Z,K,ee,te,ae,se,le;const r=S("el-empty"),d=S("el-pagination"),x=S("Plus"),L=S("el-icon"),Ue=S("el-upload"),je=S("SuccessFilled"),Me=S("Upload"),Ae=S("el-drawer"),M=Qe("lazy");return v(),y("div",ot,[a("div",it,[a("div",rt,[a("div",ut,[(Y=c.value)!=null&&Y.avatar?T((v(),y("img",{key:0,alt:"头像",title:`${((Z=c.value)==null?void 0:Z.nickname)||"默认用户"}的头像`},null,8,ct)),[[M,(K=c.value)==null?void 0:K.avatar]]):C("",!0)]),a("div",dt,[a("h2",{title:`${((ee=c.value)==null?void 0:ee.nickname)||"默认用户"}的昵称`,style:Ge({color:((te=c.value)==null?void 0:te.nicknameColor)||"#000"})},h((ae=c.value)==null?void 0:ae.nickname),13,pt),a("p",{title:`${((se=c.value)==null?void 0:se.nickname)||"默认用户"}的签名`,class:"bio"},h((le=c.value)==null?void 0:le.introduce),9,vt)])]),a("div",mt,[a("div",gt,[a("span",ft,h(l(k).length),1),t[5]||(t[5]=a("span",{class:"label"},"博客文章",-1))]),a("div",yt,[a("span",ht,h(l(z).length),1),t[6]||(t[6]=a("span",{class:"label"},"摄影图库",-1))]),a("div",_t,[a("span",bt,h(l($).length),1),t[7]||(t[7]=a("span",{class:"label"},"随笔随记",-1))])])]),a("div",kt,[(v(),y(F,null,oe(o,n=>a("div",{key:n.id,class:ie(["nav-item",{active:f.value===n.id}]),onClick:A=>ke(n.id)},[a("span",wt,h(n.icon),1),a("span",xt,h(n.text),1)],10,Ct)),64))]),a("div",Ot,[i(He,{name:"content-fade",tag:"div",class:"content-grid"},{default:_(()=>[(v(!0),y(F,null,oe(W.value,n=>{var A;return v(),y("div",{key:n.id,class:"content-card",onClick:Be=>xe(n),title:`${((A=c.value)==null?void 0:A.nickname)||"默认用户"}的${he.value[n.type]||"个人分享"}`},[a("div",$t,[T(a("img",null,null,512),[[M,n.image]]),a("div",St,[a("span",It,h(Ce(n.createdAt)),1)])]),a("div",Pt,[n.type!=="photography"?(v(),y(F,{key:0},[a("h3",Et,h(Ve(n)),1),a("p",Vt,h(De(n)),1)],64)):C("",!0),a("div",Dt,[n.type==="essay"?(v(),y("span",Lt,h(Le(n)),1)):C("",!0),a("div",Nt,[n.type==="essay"?(v(),y("button",{key:0,class:"like-btn",onClick:re(Be=>we(n.id,X(n)),["stop"])},[i(l(Ye),{class:ie({liked:X(n)})},null,8,["class"]),a("span",jt,h(Ne(n)),1)],8,Ut)):C("",!0),n.type==="essay"?(v(),y("button",{key:1,class:"views-btn",onClick:t[0]||(t[0]=re(()=>{},["stop"]))},[i(l(q)),a("span",Mt,"浏览"+h(n.views)+"次",1)])):C("",!0)])])])],8,zt)}),128))]),_:1}),W.value.length===0?(v(),y("div",At,[i(r,{description:`暂无${Ee(f.value)}内容`},null,8,["description"])])):C("",!0)]),i(d,{layout:"prev, pager, next",background:"","current-page":P.value,"page-size":E.value,total:me.value,onCurrentChange:_e,class:"pagination"},null,8,["current-page","page-size","total"]),i(Ae,{modelValue:l(w),"onUpdate:modelValue":t[4]||(t[4]=n=>Je(w)?w.value=n:w=n),direction:l(pe),"before-close":ze,"close-on-click-modal":!1},{default:_(()=>[i(l(J),{style:{position:"fixed",top:"23px",color:"skyblue"}}),i(l(Xe),{model:l(s),"label-width":"80px"},{default:_(()=>[l(s).type==="essay"||l(s).type==="notes"?(v(),R(l(V),{key:0,label:"标题"},{default:_(()=>[i(l(G),{modelValue:l(s).title,"onUpdate:modelValue":t[1]||(t[1]=n=>l(s).title=n)},null,8,["modelValue"])]),_:1})):C("",!0),l(s).type==="essay"||l(s).type==="notes"?(v(),R(l(V),{key:1,label:"内容"},{default:_(()=>[i(l(G),{modelValue:l(s).content,"onUpdate:modelValue":t[2]||(t[2]=n=>l(s).content=n),type:"textarea"},null,8,["modelValue"])]),_:1})):C("",!0),i(l(V),{label:"图库"},{default:_(()=>[i(Ue,{class:"article-uploader",action:`${l(H)}/admin/upload`,"show-file-list":!1,"before-upload":Ie,"on-success":Pe,method:"post",data:{userId:l(I)},name:"image","auto-upload":!1,ref_key:"uploadRef",ref:g,onChange:fe},{default:_(()=>[a("div",Bt,[l(s).image?T((v(),y("img",Tt,null,512)),[[M,l(s).image]]):(v(),y("div",Ft,[i(L,{class:"upload-icon"},{default:_(()=>[i(x)]),_:1}),t[8]||(t[8]=a("span",{class:"upload-text"},"点击上传图片",-1))]))])]),_:1},8,["action","data"])]),_:1}),l(s).type==="essay"?(v(),R(l(V),{key:2,label:"标签"},{default:_(()=>[i(l(G),{modelValue:l(s).label,"onUpdate:modelValue":t[3]||(t[3]=n=>l(s).label=n)},null,8,["modelValue"])]),_:1})):C("",!0),i(l(V),null,{default:_(()=>[i(l(Ze),{type:"danger",onClick:$e,style:{width:"100%",display:"flex","justify-content":"flex-end",color:"#b04343"}})]),_:1}),i(l(V),{style:{position:"fixed",bottom:"0",right:"10px"}},{default:_(()=>[a("div",{type:"primary",class:"avatar-upload",onClick:Oe,style:{right:"20px"}},[i(L,null,{default:_(()=>[i(je)]),_:1}),t[9]||(t[9]=a("span",null,"保存",-1))]),l(N)?(v(),y("div",{key:0,class:"avatar-upload",onClick:Q},[i(L,null,{default:_(()=>[i(Me)]),_:1}),t[10]||(t[10]=a("span",null,"上传",-1))])):C("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","direction"])])}}}),Wt=tt(Rt,[["__scopeId","data-v-56dce5df"]]);export{Wt as default};
