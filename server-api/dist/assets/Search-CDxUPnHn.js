import{d as B,i as U,o as t,c as s,f as p,x as _,y as f,e as c,A as x,B as z,a as u,h as d,j as V,g as L,w,J as I,K as $,n as N,r as v,m as j,k as E}from"./index-DaoAQrrJ.js";import{f as F,z as J}from"./zh-CN-ZPh2jKaf.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"result-image"},Q=["src","alt"],q={class:"result-details"},G={key:0,class:"result-title"},H={key:1,class:"result-label"},O={class:"result-date"},P=B({__name:"ResultItem",props:{item:{}},setup(y){const o=y,l=U(),n=e=>F(new Date(e),{addSuffix:!0,locale:J}),m=()=>{o.item.title?l.push(`/article/${o.item.id}`):l.push(`/photography/${o.item.id}`)};return(e,g)=>(t(),s("div",{class:"result-item",onClick:m},[p("div",M,[p("img",{src:e.item.image,alt:e.item.title,class:"result-image"},null,8,Q)]),p("div",q,[e.item.title?(t(),s("h4",G,_(e.item.title),1)):f("",!0),e.item.label?(t(),s("p",H,_(e.item.label),1)):f("",!0),p("p",O,_(n(e.item.createdAt)),1)])]))}}),W=S(P,[["__scopeId","data-v-84824d96"]]),X={class:"search-container"},Y={key:0,class:"loading"},Z={key:1,class:"error"},ee={key:2},te={class:"section-title"},se={key:0,class:"result-grid"},le={key:1,class:"no-results"},ae=B({__name:"Search",setup(y){let o=c(""),l=c("all"),n=c(null),m=c(!1),e=c("");const g=x(()=>{if(!n.value)return[];const a=[{title:"博客文章",items:n.value.articles.list||[]},{title:"摄影图库",items:n.value.photographies.list||[]},{title:"随笔随记",items:n.value.notes.list||[]}];return l.value!=="all"?a.filter(i=>i.title.toLowerCase()===l.value):a});let k=c(null);function D(){N.get("/users/me",{}).then(a=>{k.value=a.data.data.id}).catch(a=>{console.log("获取用户信息失败")})}const b=async()=>{m.value=!0,e.value="";try{const a=await N.get("/search/search",{params:{keyword:o.value,type:l.value,userId:k.value}});n.value=a.data.data}catch(a){e.value="搜索失败，请重试",console.error("搜索失败:",a)}finally{m.value=!1}};return z(()=>{D()}),(a,i)=>{const R=v("el-input"),h=v("el-option"),A=v("el-select"),K=v("el-button");return t(),s("div",X,[u(R,{modelValue:d(o),"onUpdate:modelValue":i[0]||(i[0]=r=>V(o)?o.value=r:o=r),placeholder:"请输入搜索关键词",onKeyup:L(b,["enter"]),class:"search-input"},null,8,["modelValue"]),u(A,{modelValue:d(l),"onUpdate:modelValue":i[1]||(i[1]=r=>V(l)?l.value=r:l=r),placeholder:"选择搜索类型",class:"search-type"},{default:w(()=>[u(h,{label:"全部",value:"all"}),u(h,{label:"博客文章",value:"articles"}),u(h,{label:"摄影图库",value:"photographies"}),u(h,{label:"随笔随记",value:"notes"})]),_:1},8,["modelValue"]),u(K,{type:"primary",onClick:b,class:"search-button"},{default:w(()=>i[2]||(i[2]=[j("搜索")])),_:1}),d(m)?(t(),s("div",Y,"加载中...")):d(e)?(t(),s("div",Z,_(d(e)),1)):d(n)?(t(),s("div",ee,[(t(!0),s(I,null,$(g.value,(r,T)=>(t(),s("section",{key:T},[p("h3",te,_(r.title),1),r.items.length?(t(),s("div",se,[(t(!0),s(I,null,$(r.items,C=>(t(),E(W,{key:C.id,item:C},null,8,["item"]))),128))])):(t(),s("div",le,"没有找到相关结果"))]))),128))])):f("",!0)])}}}),ie=S(ae,[["__scopeId","data-v-5a1f182e"]]);export{ie as default};
