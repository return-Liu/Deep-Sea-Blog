import{a as i,d as Be,u as Fe,P as T,e as m,a2 as oe,A as Re,c as y,f as a,t as B,z as C,N as Ge,y as h,h as l,U as F,V as ie,w as _,a3 as He,j as qe,n as $,E as b,M as Je,r as P,T as We,i as Ye,o as v,a1 as re,s as ue,q as Qe,k as R,a4 as G,a5 as V,Y as H}from"./index-BDg1WjkS.js";import{I as pe,H as Xe}from"./HeartOutlined-4517EROV.js";import{D as Ze}from"./DeleteOutlined-9Muhh3ma.js";import{f as Ke,z as et}from"./zh-CN-ZPh2jKaf.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";var at={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"};function ce(p){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?Object(arguments[o]):{},u=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(c).filter(function(g){return Object.getOwnPropertyDescriptor(c,g).enumerable}))),u.forEach(function(g){st(p,g,c[g])})}return p}function st(p,o,c){return o in p?Object.defineProperty(p,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):p[o]=c,p}var q=function(o,c){var u=ce({},o,c.attrs);return i(pe,ce({},u,{icon:at}),null)};q.displayName="EditOutlined";q.inheritAttrs=!1;var lt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"};function de(p){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?Object(arguments[o]):{},u=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(u=u.concat(Object.getOwnPropertySymbols(c).filter(function(g){return Object.getOwnPropertyDescriptor(c,g).enumerable}))),u.forEach(function(g){nt(p,g,c[g])})}return p}function nt(p,o,c){return o in p?Object.defineProperty(p,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):p[o]=c,p}var J=function(o,c){var u=de({},o,c.attrs);return i(pe,de({},u,{icon:lt}),null)};J.displayName="EyeOutlined";J.inheritAttrs=!1;const ot={class:"share-container"},it={class:"profile-section"},rt={class:"profile-info"},ut={class:"avatar"},ct=["title"],dt={class:"user-info"},pt=["title"],vt=["title"],mt={class:"stats"},gt={class:"stat-item"},ft={class:"number"},yt={class:"stat-item"},ht={class:"number"},_t={class:"stat-item"},bt={class:"number"},kt={class:"content-nav"},Ct=["onClick"],wt={class:"icon"},xt={class:"text"},Ot={class:"content-section"},zt=["onClick","title"],$t={class:"card-media"},Pt={class:"card-overlay"},St={class:"date"},It={class:"card-content"},Et={class:"title"},Vt={class:"excerpt"},Dt={class:"card-actions"},Nt={key:0,class:"tag"},Lt={class:"action-buttons"},Mt=["onClick"],Ut={class:"like-count"},jt={class:"views-count"},At={key:0,class:"empty-state"},Tt={class:"upload-container"},Bt={key:0,class:"uploaded-image"},Ft={key:1,class:"upload-placeholder"},Rt=Be({__name:"Share",setup(p){var X;const o=[{id:"essays",text:"åšå®¢æ–‡ç« ",icon:"ðŸ“"},{id:"photographys",text:"æ‘„å½±å›¾åº“",icon:"ðŸ“¸"},{id:"notes",text:"éšç¬”éšè®°",icon:"âœ¨"}],c=Fe(),u=T(()=>c.user),g=m(null);let L=m(!1),k=m([]),O=m([]),z=m([]),S=m(null),w=m(!1),ve=m("rtl"),s=m({size:0}),D=m({}),me=m("");const I=m(1),E=m(10),ge=T(()=>f.value==="essays"?k.value.length+O.value.length+z.value.length:f.value==="photographys"?O.value.length+k.value.length+z.value.length:f.value==="notes"?z.value.length+k.value.length+O.value.length:0);S.value=((X=u.value)==null?void 0:X.id)||null;const fe=()=>s.value.title!==D.value.title||s.value.content!==D.value.content||s.value.label!==D.value.label||s.value.image!==D.value.image,W=()=>{g.value.submit()},ye=(e,t)=>{L.value=t.length>0};async function M(){try{const[e,t,r]=await Promise.all([$.get("/admin/article",{params:{userId:S.value,page:I.value,pageSize:E.value}}),$.get("/admin/photography",{params:{userId:S.value,page:I.value,pageSize:E.value}}),$.get("/admin/note",{params:{userId:S.value,page:I.value,pageSize:E.value}})]);k.value=e.data.data.articles.map(d=>({...d,type:"essay",views:d.views||0,isViewed:!1})),O.value=t.data.data.photography.map(d=>({...d,type:"photography"})),z.value=r.data.data.notes.map(d=>({...d,type:"notes"}))}catch(e){console.error("èŽ·å–æ•°æ®å¤±è´¥:",e),b.error("èŽ·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•")}}const he=m({notes:"éšç¬”éšè®°",photography:"æ‘„å½±å›¾åº“",essay:"åšå®¢æ–‡ç« "}),Y=T(()=>{const e=(I.value-1)*E.value,t=e+E.value;let r=[];return f.value==="essays"?r=[...k.value,...O.value,...z.value]:f.value==="photographys"?r=[...O.value,...k.value,...z.value]:f.value==="notes"&&(r=[...z.value,...k.value,...O.value]),r.slice(e,t)}),_e=e=>{I.value=e},U=Je(),be=Ye(),ke=e=>{f.value=e,be.push({name:"Share",params:{tab:e}})},f=m(Array.isArray(U.params.tab)?U.params.tab[0]:U.params.tab||"essays");oe(f,()=>{I.value=1,M()}),oe(()=>U.params.tab,e=>{f.value=Array.isArray(e)?e[0]:e||"essays"});const Ce=e=>Ke(new Date(e),{addSuffix:!0,locale:et});async function we(e,t){try{const r=await $.post("/admin/likes/like",{articleId:e,userId:S.value}),d=k.value.findIndex(x=>x.id===e);d!==-1&&(k.value[d].isLiked=!t,k.value[d].likesCount=r.data.likeCount)}catch(r){console.error("ç‚¹èµž/å–æ¶ˆç‚¹èµžå¤±è´¥",r),b.error("ç‚¹èµž/å–æ¶ˆç‚¹èµžå¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•")}}const xe=e=>{s.value={...e},D.value={...e},me.value=e.type,w.value=!0};async function Oe(){try{if(fe()){const{id:e,type:t,size:r}=s.value;let d="",x={};switch(t){case"essay":d=`/admin/article/${e}`,x={title:s.value.title,content:s.value.content,label:s.value.label,image:s.value.image,size:r};break;case"photography":d=`/admin/photography/${e}`,x={image:s.value.image,size:r};break;case"notes":d=`/admin/note/${e}`,x={title:s.value.title,content:s.value.content,image:s.value.image,size:r};break}await $.put(d,x),W(),M(),b.success("æ›´æ–°æˆåŠŸ"),w.value=!1}else b.info("æ²¡æœ‰å‘çŽ°ä»»ä½•æ›´æ”¹ï¼Œè¯·ä¿®æ”¹åŽå†æ¥ä¿å­˜"),w.value=!1}catch(e){console.error("ä¿å­˜å¤±è´¥:",e),b.error("ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼")}}const ze=async e=>{w.value=!1,L.value=!1,e()},$e=()=>{var t;const e=(t=s.value)==null?void 0:t.id;e!==void 0?Pe(e):b.error("æ— æ³•èŽ·å–å†…å®¹ IDï¼Œè¯·é‡è¯•")};let Pe=async e=>{try{let t="";switch(s.value.type){case"essay":t=`/admin/article/${e}`;break;case"photography":t=`/admin/photography/${e}`;break;case"notes":t=`/admin/note/${e}`;break}if(s.value.image){const r=s.value.image.split("/").pop();await $.delete(`/admin/upload/image/${r}`)}await $.delete(t),M(),b.success("åˆ é™¤æˆåŠŸ"),w.value=!1}catch(t){console.error("åˆ é™¤å¤±è´¥",t),b.error("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•")}};const Se=e=>{const r=["image/jpeg","image/png","image/webp","image/gif"].includes(e.type),d=e.size/1024/1024<2;if(r||b.error("ä¸Šä¼ å›¾ç‰‡åªèƒ½æ˜¯ JPG æˆ– PNG æˆ– WEBP æˆ– GIF æ ¼å¼!"),d||b.error("ä¸Šä¼ å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 2MB!"),!S.value)return b.error("IDæœªæ‰¾åˆ°ï¼Œè¯·é‡æ–°ç™»å½•"),!1;if(s.value.size=e.size,s.value.image){const N=s.value.image.split("/").pop();$.delete(`${H}/admin/upload/image/${N}`),b.error("æ—§å›¾ç‰‡å·²åˆ é™¤,å·²é‡æ–°ä¸Šä¼ æ–°å›¾ç‰‡")}return r&&d},Ie=(e,t)=>{s.value.image=`${H}/image/${e.data.image}`,b.success("å›¾ç‰‡ä¸Šä¼ æˆåŠŸ"),g.value.clearFiles(),L.value=!1},Ee=e=>{var t;return((t=o.find(r=>r.id===e))==null?void 0:t.text)||""},Ve=e=>(f.value==="essay",e.title),De=e=>(f.value==="essay",e.content),Ne=e=>e.label,Q=e=>e.isLiked,Le=e=>e.likesCount;return Re(()=>{M()}),(e,t)=>{var Z,K,ee,te,ae,se,le,ne;const r=P("el-empty"),d=P("el-pagination"),x=P("Plus"),N=P("el-icon"),Me=P("el-upload"),Ue=P("SuccessFilled"),je=P("Upload"),Ae=P("el-drawer"),j=We("lazy");return v(),y("div",ot,[a("div",it,[a("div",rt,[a("div",ut,[(Z=u.value)!=null&&Z.avatar?B((v(),y("img",{key:0,alt:"å¤´åƒ",title:`${((K=u.value)==null?void 0:K.nickname)||"é»˜è®¤ç”¨æˆ·"}çš„å¤´åƒ`},null,8,ct)),[[j,(ee=u.value)==null?void 0:ee.avatar]]):C("",!0)]),a("div",dt,[a("h2",{title:`${((te=u.value)==null?void 0:te.nickname)||"é»˜è®¤ç”¨æˆ·"}çš„æ˜µç§°`,style:Ge({color:((ae=u.value)==null?void 0:ae.nicknameColor)||"#000"})},h((se=u.value)==null?void 0:se.nickname),13,pt),a("p",{title:`${((le=u.value)==null?void 0:le.nickname)||"é»˜è®¤ç”¨æˆ·"}çš„ç­¾å`,class:"bio"},h((ne=u.value)==null?void 0:ne.introduce),9,vt)])]),a("div",mt,[a("div",gt,[a("span",ft,h(l(k).length),1),t[5]||(t[5]=a("span",{class:"label"},"åšå®¢æ–‡ç« ",-1))]),a("div",yt,[a("span",ht,h(l(O).length),1),t[6]||(t[6]=a("span",{class:"label"},"æ‘„å½±å›¾åº“",-1))]),a("div",_t,[a("span",bt,h(l(z).length),1),t[7]||(t[7]=a("span",{class:"label"},"éšç¬”éšè®°",-1))])])]),a("div",kt,[(v(),y(F,null,ie(o,n=>a("div",{key:n.id,class:re(["nav-item",{active:f.value===n.id}]),onClick:A=>ke(n.id)},[a("span",wt,h(n.icon),1),a("span",xt,h(n.text),1)],10,Ct)),64))]),a("div",Ot,[i(He,{name:"content-fade",tag:"div",class:"content-grid"},{default:_(()=>[(v(!0),y(F,null,ie(Y.value,n=>{var A;return v(),y("div",{key:n.id,class:"content-card",onClick:Te=>xe(n),title:`${((A=u.value)==null?void 0:A.nickname)||"é»˜è®¤ç”¨æˆ·"}çš„${he.value[n.type]||"ä¸ªäººåˆ†äº«"}`},[a("div",$t,[B(a("img",null,null,512),[[j,n.image]]),a("div",Pt,[a("span",St,h(Ce(n.createdAt)),1)])]),a("div",It,[n.type!=="photography"?(v(),y(F,{key:0},[a("h3",Et,h(Ve(n)),1),a("p",Vt,h(De(n)),1)],64)):C("",!0),a("div",Dt,[n.type==="essay"?(v(),y("span",Nt,h(Ne(n)),1)):C("",!0),a("div",Lt,[n.type==="essay"?(v(),y("button",{key:0,class:"like-btn",onClick:ue(Te=>we(n.id,Q(n)),["stop"])},[i(l(Xe),{class:re({liked:Q(n)})},null,8,["class"]),a("span",Ut,h(Le(n)),1)],8,Mt)):C("",!0),n.type==="essay"?(v(),y("button",{key:1,class:"views-btn",onClick:t[0]||(t[0]=ue(()=>{},["stop"]))},[i(l(J)),a("span",jt,"æµè§ˆ"+h(n.views)+"æ¬¡",1)])):C("",!0)])])])],8,zt)}),128))]),_:1}),Y.value.length===0?(v(),y("div",At,[i(r,{description:`æš‚æ— ${Ee(f.value)}å†…å®¹`},null,8,["description"])])):C("",!0)]),i(d,{layout:"prev, pager, next",background:"","current-page":I.value,"page-size":E.value,total:ge.value,onCurrentChange:_e,class:"pagination"},null,8,["current-page","page-size","total"]),i(Ae,{modelValue:l(w),"onUpdate:modelValue":t[4]||(t[4]=n=>qe(w)?w.value=n:w=n),direction:l(ve),"before-close":ze,"close-on-click-modal":!1},{default:_(()=>[i(l(q),{style:{position:"fixed",top:"23px",color:"skyblue"}}),i(l(Qe),{model:l(s),"label-width":"80px"},{default:_(()=>[l(s).type==="essay"||l(s).type==="notes"?(v(),R(l(V),{key:0,label:"æ ‡é¢˜"},{default:_(()=>[i(l(G),{modelValue:l(s).title,"onUpdate:modelValue":t[1]||(t[1]=n=>l(s).title=n)},null,8,["modelValue"])]),_:1})):C("",!0),l(s).type==="essay"||l(s).type==="notes"?(v(),R(l(V),{key:1,label:"å†…å®¹"},{default:_(()=>[i(l(G),{modelValue:l(s).content,"onUpdate:modelValue":t[2]||(t[2]=n=>l(s).content=n),type:"textarea"},null,8,["modelValue"])]),_:1})):C("",!0),i(l(V),{label:"å›¾åº“"},{default:_(()=>[i(Me,{class:"article-uploader",action:`${l(H)}/admin/upload`,"show-file-list":!1,"before-upload":Se,"on-success":Ie,method:"post",data:{userId:l(S)},name:"image","auto-upload":!1,ref_key:"uploadRef",ref:g,onChange:ye},{default:_(()=>[a("div",Tt,[l(s).image?B((v(),y("img",Bt,null,512)),[[j,l(s).image]]):(v(),y("div",Ft,[i(N,{class:"upload-icon"},{default:_(()=>[i(x)]),_:1}),t[8]||(t[8]=a("span",{class:"upload-text"},"ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡",-1))]))])]),_:1},8,["action","data"])]),_:1}),l(s).type==="essay"?(v(),R(l(V),{key:2,label:"æ ‡ç­¾"},{default:_(()=>[i(l(G),{modelValue:l(s).label,"onUpdate:modelValue":t[3]||(t[3]=n=>l(s).label=n)},null,8,["modelValue"])]),_:1})):C("",!0),i(l(V),null,{default:_(()=>[i(l(Ze),{type:"danger",onClick:$e,style:{width:"100%",display:"flex","justify-content":"flex-end",color:"#b04343"}})]),_:1}),i(l(V),{style:{position:"fixed",bottom:"0",right:"10px"}},{default:_(()=>[a("div",{type:"primary",class:"avatar-upload",onClick:Oe,style:{right:"20px"}},[i(N,null,{default:_(()=>[i(Ue)]),_:1}),t[9]||(t[9]=a("span",null,"ä¿å­˜",-1))]),l(L)?(v(),y("div",{key:0,class:"avatar-upload",onClick:W},[i(N,null,{default:_(()=>[i(je)]),_:1}),t[10]||(t[10]=a("span",null,"ä¸Šä¼ ",-1))])):C("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","direction"])])}}}),Yt=tt(Rt,[["__scopeId","data-v-dc8d69f6"]]);export{Yt as default};
