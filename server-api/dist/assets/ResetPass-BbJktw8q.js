import{d as V,e as a,c as n,f as s,s as f,t as w,x as u,y as v,z as I,i as M,n as g,E as o,o as d}from"./index-DaoAQrrJ.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"forget-password-container"},N={class:"form-group"},R={key:0,class:"error"},U={class:"form-group"},D=["disabled"],K={key:0,class:"error"},T={class:"form-group"},Y={key:0,class:"error"},z=["disabled"],$={key:0,class:"success"},j={key:1,class:"error"},q=V({__name:"ResetPass",setup(A){const b=M(),r=a(""),m=a(""),i=a(""),t=a({email:"",verificationCode:"",newPassword:""}),_=a(""),y=a(""),p=a(!1),C=a(!1),P=()=>r.value?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.value)?(t.value.email="",!0):(o.error("邮箱格式不正确"),!1):(o.error("邮箱不能为空"),!1),h=()=>m.value?(t.value.verificationCode="",!0):(o.error("验证码不能为空"),!1),S=()=>i.value?i.value.length<6||i.value.length>45?(t.value.newPassword="新密码长度在6到45个字符之间",!1):(t.value.newPassword="",!0):(t.value.newPassword="新密码不能为空",!1),k=async()=>{if(P()){p.value=!0;try{const l=await g.post("/email/getemail",{email:r.value}),{code:e}=l.data.data;sessionStorage.setItem("code",e),o.success("验证码发送成功")}catch{o.error("发送验证码失败")}}},x=async()=>{if(!(!P()||!h()||!S())){try{if(await g.post("/email/checkemail",{email:r.value,code:sessionStorage.getItem("code")}),m.value!==sessionStorage.getItem("code")){o.error("验证码错误,请你输入正确的验证码");return}}catch{o.error("您的邮箱不存在,请先注册");return}try{await g.post("/email/resetpassword",{email:r.value,code:sessionStorage.getItem("code"),password:i.value,currentPassword:i.value}),o.success("重置密码成功，请重新登录"),sessionStorage.removeItem("code"),setTimeout(()=>{b.push("/login")},5e3)}catch{o.error("新密码与旧密码相同,请你换个新密码~")}}};return(l,e)=>(d(),n("div",B,[e[6]||(e[6]=s("h2",{class:"reset-title"},"逸刻时光-YiKe重置密码",-1)),s("form",{onSubmit:I(x,["prevent"])},[s("div",N,[e[3]||(e[3]=s("label",{for:"email"},"邮箱",-1)),f(s("input",{type:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=c=>r.value=c),placeholder:"请输入您的邮箱"},null,512),[[w,r.value]]),t.value.email?(d(),n("p",R,u(t.value.email),1)):v("",!0)]),s("div",U,[e[4]||(e[4]=s("label",{for:"verificationCode"},"验证码",-1)),f(s("input",{type:"text",id:"verificationCode","onUpdate:modelValue":e[1]||(e[1]=c=>m.value=c),placeholder:"请输入验证码"},null,512),[[w,m.value]]),s("button",{type:"button",onClick:k,disabled:p.value},u(p.value?"发送中...":"发送验证码"),9,D),t.value.verificationCode?(d(),n("p",K,u(t.value.verificationCode),1)):v("",!0)]),s("div",T,[e[5]||(e[5]=s("label",{for:"newPassword"},"新密码",-1)),f(s("input",{type:"password",id:"newPassword","onUpdate:modelValue":e[2]||(e[2]=c=>i.value=c),placeholder:"请输入新密码"},null,512),[[w,i.value]]),t.value.newPassword?(d(),n("p",Y,u(t.value.newPassword),1)):v("",!0)]),s("button",{type:"submit",disabled:C.value},"提交",8,z),_.value?(d(),n("p",$,u(_.value),1)):v("",!0),y.value?(d(),n("p",j,u(y.value),1)):v("",!0)],32),e[7]||(e[7]=s("p",{class:"register-tip"}," 请注意，此重置密码功能仅限于逸刻时光-YiKe网站的测试和学习用途。请确保您输入的邮箱地址是正确的，并妥善保护您的个人隐私和个人信息，以避免不必要的风险。谢谢您的配合。 ",-1))]))}}),H=E(q,[["__scopeId","data-v-67705ad1"]]);export{H as default};
