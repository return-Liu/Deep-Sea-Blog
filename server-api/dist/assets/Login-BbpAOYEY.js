import{d as K,u as S,b as F,e as w,c as N,f as m,a,w as n,g as T,h as t,i as L,r as i,o as f,j as R,k as y,v as j,l as D,m as _,n as C,p as I,E as u}from"./index-BDg1WjkS.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"login-container"},Y={class:"login-card"},$={class:"login-links"},q=K({__name:"Login",setup(z){const c=L(),h=S(),k=F();let s=w({account:"",password:""}),r=w(!1),x=()=>s.value.account?s.value.password?!0:(u.error("请输入密码~"),!1):(u.error("请输入账号~"),!1),V=()=>{c.push("/register")},b=()=>{c.push("/resetpass")},g=async()=>{if(x())try{const l=await C.post("/auth/sign_in",{login:s.value.account,password:s.value.password});if(I.set("token",l.data.data.token),l.data.status){u.success("登录成功");const o=(await C.get("/users/me")).data.data;(o&&o.username===s.value.account||o.email===s.value.account)&&(h.setUser({id:o.id,nickname:o.nickname,avatar:o.avatar,sex:o.sex,birthday:o.birthday,introduce:o.introduce,constellation:o.constellation,nicknameColor:o.nicknameColor,clientFeatureCode:o.clientFeatureCode}),k.setUser(o.id),k.loadTheme(),c.push("/home"))}}catch(l){if(l.response&&l.response.data){const e=l.response.data;e.errors&&e.errors.forEach(o=>{u.error(o)})}else u.error("登录失败，请重试")}};return(l,e)=>{const o=i("el-input"),p=i("el-form-item"),U=i("el-icon"),B=i("el-button"),E=i("el-form"),v=i("el-link");return f(),N("div",P,[m("div",Y,[e[6]||(e[6]=m("h2",{class:"login-title"},"逸刻时光-YiKe登录",-1)),a(E,{onKeydown:T(t(g),["enter"]),model:t(s)},{default:n(()=>[a(p,{label:"账号"},{default:n(()=>[a(o,{class:"login-input",modelValue:t(s).account,"onUpdate:modelValue":e[0]||(e[0]=d=>t(s).account=d),placeholder:"请输入账号/邮箱"},null,8,["modelValue"])]),_:1}),a(p,{label:"密码"},{default:n(()=>[a(o,{type:t(r)?"text":"password",class:"login-input",modelValue:t(s).password,"onUpdate:modelValue":e[2]||(e[2]=d=>t(s).password=d),placeholder:"请输入密码"},{suffix:n(()=>[a(U,{class:"cursor-pointer",onClick:e[1]||(e[1]=d=>R(r)?r.value=!t(r):r=!t(r))},{default:n(()=>[t(r)?(f(),y(t(j),{key:0})):(f(),y(t(D),{key:1}))]),_:1})]),_:1},8,["type","modelValue"])]),_:1}),a(p,null,{default:n(()=>[a(B,{type:"primary",onClick:t(g),class:"login-button"},{default:n(()=>e[3]||(e[3]=[_(" 登录 ")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["onKeydown","model"]),m("div",$,[a(v,{type:"primary",onClick:t(b)},{default:n(()=>e[4]||(e[4]=[_("忘记密码")])),_:1},8,["onClick"]),a(v,{type:"primary",onClick:t(V)},{default:n(()=>e[5]||(e[5]=[_("新用户注册")])),_:1},8,["onClick"])])])])}}}),H=M(q,[["__scopeId","data-v-92cd14d1"]]);export{H as default};
