import{a as t,d as Oe,u as Te,b as Me,A as J,e as u,O as Ae,B as Be,c as d,f as l,w as o,h as f,P as $e,x as D,s as G,a2 as De,J as Q,K as W,k as A,y,m as I,N as q,Q as Fe,n as B,E as C,F as X,p as Z,r as c,i as ze,L as Le,o as i,a6 as Pe,H as Ne,M as Ee,a7 as ne,a8 as He,a9 as je,aa as Re,ab as Ye}from"./index-DaoAQrrJ.js";import{I as Je,H as ie}from"./HeartOutlined-CqtU-ya3.js";import{_ as Ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-696 72h136v656H184V184zm656 656H384V384h456v456zM384 320V184h456v136H384z"}}]},name:"layout",theme:"outlined"};function ue(g){for(var r=1;r<arguments.length;r++){var v=arguments[r]!=null?Object(arguments[r]):{},_=Object.keys(v);typeof Object.getOwnPropertySymbols=="function"&&(_=_.concat(Object.getOwnPropertySymbols(v).filter(function(m){return Object.getOwnPropertyDescriptor(v,m).enumerable}))),_.forEach(function(m){We(g,m,v[m])})}return g}function We(g,r,v){return r in g?Object.defineProperty(g,r,{value:v,enumerable:!0,configurable:!0,writable:!0}):g[r]=v,g}var K=function(r,v){var _=ue({},r,v.attrs);return t(Je,ue({},_,{icon:Qe}),null)};K.displayName="LayoutOutlined";K.inheritAttrs=!1;const qe=[{label:"白羊座",value:"白羊座"},{label:"金牛座",value:"金牛座"},{label:"双子座",value:"双子座"},{label:"巨蟹座",value:"巨蟹座"},{label:"狮子座",value:"狮子座"},{label:"处女座",value:"处女座"},{label:"天秤座",value:"天秤座"},{label:"天蝎座",value:"天蝎座"},{label:"射手座",value:"射手座"},{label:"摩羯座",value:"摩羯座"},{label:"水瓶座",value:"水瓶座"},{label:"双鱼座",value:"双鱼座"}],Xe={class:"settings-page"},Ze={class:"settings-wrapper"},Ke={class:"settings-layout"},el={class:"settings-nav"},ll={class:"profile-card"},al={class:"avatar-container"},tl={key:0,class:"avatar"},sl={class:"avatar-mask"},ol={class:"chose-nickname-color"},nl={class:"nav-menu"},il=["onClick"],ul={class:"settings-main"},rl={class:"card-header"},dl={key:1},cl={class:"danger-actions"},vl={class:"action-item"},ml={class:"action-item"},pl={key:2,class:"like-section"},fl={key:0},_l={class:"like-image"},yl={class:"like-content"},gl={class:"like-title"},kl={class:"like-description"},bl={class:"like-tags"},hl={class:"like-tag"},Cl={key:1,class:"empty-state"},Vl={key:3,class:"mode-section"},wl={class:"mode-toggles"},Ul={class:"mode-item"},Sl={class:"mode-toggle"},xl={key:0,class:"mode-item"},Il={class:"mode-toggle"},Ol={key:1,class:"mode-item"},Tl={class:"mode-toggle"},Ml={key:4,class:"layout-section"},Al={class:"layout-options"},Bl={class:"layout-item"},$l={class:"layout-item"},Dl=Oe({__name:"Setting",setup(g){const r=Fe(),v=ze(),_=Te(),m=Me(),{currentTheme:Fl,toggleTheme:z,handleSystemThemeChange:zl,setTheme:Ll}=m,ee=J(()=>m.currentThemeMode==="light"),le=J(()=>m.currentThemeMode==="dark"),$=J({get:()=>m.followSystem,set:a=>{a?m.toggleTheme("system"):m.toggleTheme("light")}}),L=u(!1),k=u(""),V=u("0"),w=u(""),U=u(""),p=u(""),P=u(!1),S=u(""),N=u(null),re=u(qe.map(a=>({value:a.value,label:a.label}))),b=u("#000000");let E=u([]),de=u("");const x=u(Array.isArray(r.params.tab)?r.params.tab[0]:r.params.tab||"personal");let O=u(null);const H=u(null),h=u({nickname:"",sex:"0",birthday:"",introduce:"",imageUrl:"",constellation:"",nicknameColor:""}),ce=[{id:"personals",title:"我的资料",icon:He},{id:"securitys",title:"账号安全",icon:je},{id:"likes",title:"我的点赞",icon:ie},{id:"modes",title:"模式选择",icon:Re},{id:"layouts",title:"界面布局",icon:K}],ve=()=>{H.value.submit()},me=(a,e)=>{P.value=e.length>0},pe=a=>{x.value=a,v.push({name:"Setting",params:{tab:a}})};Ae(()=>r.params.tab,a=>{x.value=Array.isArray(a)?a[0]:a||"personal"});const fe=async()=>{try{const e=(await B.get("/users/me")).data.data;k.value=e.nickname||"",V.value=e.sex.toString()||"0",w.value=new Date(e.birthday).toISOString().slice(0,10)||"",U.value=e.introduce||"",p.value=e.avatar||"",O.value=e.id,S.value=e.constellation||"",N.value=e.clientFeatureCode||null,b.value=e.nicknameColor||"#000000",m.user=e.id.toString(),h.value={nickname:k.value,sex:V.value,birthday:w.value,introduce:U.value,imageUrl:p.value,constellation:S.value,nicknameColor:b.value}}catch(a){T(a,"获取信息失败，请重新登录")}},_e=a=>{const n=["image/jpeg","image/png","image/webp","image/jfif"].includes(a.type),j=a.size/1024/1024<2;return n?j?O.value?(p.value&&ae(),!0):(C.error("ID未找到，请重新登录"),!1):(C.error("上传头像图片大小不能超过 2MB!"),!1):(C.error("上传图片只能是 JPG 或 PNG 或 WEBP 或 JFIF 格式!"),!1)},ae=async()=>{try{if(p.value){const a=p.value.split("/").pop();await B.delete(`${X}/admin/uploadavatar/avatar/${a}`)}C.success("旧头像已删除,已重新上传新头像")}catch(a){T(a,"删除旧头像失败")}},ye=(a,e)=>{p.value=`${X}/avatar/${a.data.avatar}`,C.success("头像上传成功"),H.value.clearFiles(),P.value=!1},ge=async()=>{if(k.value===h.value.nickname&&V.value===h.value.sex&&w.value===h.value.birthday&&U.value===h.value.introduce&&p.value===h.value.imageUrl&&S.value===h.value.constellation&&b.value===h.value.nicknameColor){C.info("没有发现任何更改,请修改后再来保存");return}try{const e=(await B.put("/users/info",{nickname:k.value,sex:parseInt(V.value,10),birthday:w.value,introduce:U.value,avatar:p.value,constellation:S.value,nicknameColor:b.value})).data.data;k.value=e.nickname||"",V.value=e.sex.toString()||"0",w.value=e.birthday||"",U.value=e.introduce||"",p.value=e.avatar||de.value,S.value=e.constellation||"",b.value=e.nicknameColor||"#000000",_.setUser(e),h.value={nickname:k.value,sex:V.value,birthday:w.value,introduce:U.value,imageUrl:p.value,constellation:S.value,nicknameColor:b.value},C.success("更新信息成功")}catch(a){T(a,"更新信息失败，请稍后再试")}},ke=async()=>{try{await Ye.confirm("您确定要注销账号吗？您的所有资源将被删除。请谨慎操作。","确认注销",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _.deleteAllUserImages(),await B.delete("/users/resources",{data:{userId:O.value}}),p.value&&await ae(),localStorage.removeItem(`theme-${O.value}`),await B.delete("/users/delete"),Z.remove("token"),_.clearUser(),m.clearUserTheme(),C.success("账号已注销"),v.push({name:"login"})}catch(a){a!=="cancel"&&T(a,"注销账号失败，请稍后再试")}},be=async()=>{try{if(!O.value){T(null,"ID未找到，请重新登录");return}const e=(await B.get("/admin/article",{params:{userId:O.value}})).data.data.articles;E.value=e.filter(n=>n.likesCount===1).map(n=>({id:n.id,title:n.title,content:n.content,image:n.image,likesCount:n.likesCount,label:n.label}))}catch(a){T(a,"获取点赞文章失败，请稍后再试")}},he=()=>{Z.remove("token"),_.clearUser(),v.push({name:"login"})},T=(a,e)=>{var n;((n=a==null?void 0:a.response)==null?void 0:n.status)===401?(Z.remove("token"),v.push({name:"login"})):(C.error(e),console.error(e,a))};return Be(()=>{fe().then(()=>{be()})}),(a,e)=>{const n=c("el-icon"),j=c("el-upload"),F=c("el-input"),Ce=c("Upload"),Ve=c("SuccessFilled"),M=c("el-form-item"),R=c("el-radio"),we=c("el-radio-group"),Ue=c("el-date-picker"),Se=c("el-option"),xe=c("el-select"),te=c("el-card"),Ie=c("el-form"),se=c("el-button"),Y=c("el-switch"),oe=Le("lazy");return i(),d("div",Xe,[l("div",Ze,[e[35]||(e[35]=l("h1",{class:"page-title"},"通用设置",-1)),l("div",Ke,[l("div",el,[l("div",ll,[t(j,{class:"avatar-uploader",action:`${f(X)}/admin/uploadavatar`,"show-file-list":!1,"before-upload":_e,"on-success":ye,method:"post",data:{userId:f(O)},name:"avatar","auto-upload":!1,ref_key:"uploadRef",ref:H,onChange:me},{default:o(()=>[l("div",al,[p.value?G((i(),d("img",tl,null,512)),[[oe,p.value]]):(i(),A(n,{key:1,class:"avatar-icon"},{default:o(()=>[t(f(Pe))]),_:1})),l("div",sl,[t(n,null,{default:o(()=>[t(f(Ne))]),_:1}),e[12]||(e[12]=l("span",null,"更换头像",-1))])])]),_:1},8,["action","data"]),l("h3",{style:$e({color:b.value}),class:"profile-name"},D(k.value||"设置昵称"),5),G(l("div",ol,[t(F,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),class:"nickname-color-input",type:"color",placeholder:"选择颜色"},null,8,["modelValue"])],512),[[De,L.value]]),l("div",{class:"nickname-color-label",onClick:e[1]||(e[1]=s=>L.value=!L.value)}," 修改我的昵称颜色 ")]),l("div",nl,[(i(),d(Q,null,W(ce,s=>l("div",{key:s.id,class:q(["nav-item",{active:x.value===s.id}]),onClick:Pl=>pe(s.id)},[t(n,null,{default:o(()=>[(i(),A(Ee(s.icon)))]),_:2},1024),I(" "+D(s.title),1)],10,il)),64))])]),l("div",ul,[x.value==="personals"?(i(),A(Ie,{key:0,class:"settings-form","label-position":"top"},{default:o(()=>[t(te,{class:"form-card"},{header:o(()=>[l("div",rl,[e[15]||(e[15]=l("h2",{class:"card-title"},"基本信息",-1)),P.value?(i(),d("div",{key:0,style:{position:"fixed",right:"370px"},class:"avatar-upload",onClick:ve},[t(n,null,{default:o(()=>[t(Ce)]),_:1}),e[13]||(e[13]=l("span",null,"上传头像",-1))])):y("",!0),l("div",{type:"primary",class:"avatar-upload","native-type":"submit",onClick:ge},[t(n,null,{default:o(()=>[t(Ve)]),_:1}),e[14]||(e[14]=l("span",null,"保存更改",-1))])])]),default:o(()=>[t(M,{label:"昵称"},{default:o(()=>[t(F,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),t(M,{label:"特征码 (用于校验客户端安全性，注册后不可修改)","label-style":{color:"#FFCCCC"}},{default:o(()=>[t(F,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=s=>N.value=s),disabled:!0},null,8,["modelValue"])]),_:1}),t(M,{label:"性别"},{default:o(()=>[t(we,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=s=>V.value=s)},{default:o(()=>[t(R,{label:"1"},{default:o(()=>e[16]||(e[16]=[I("男")])),_:1}),t(R,{label:"2"},{default:o(()=>e[17]||(e[17]=[I("女")])),_:1}),t(R,{label:"0"},{default:o(()=>e[18]||(e[18]=[I("保密")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"生日"},{default:o(()=>[t(Ue,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=s=>w.value=s),type:"date",placeholder:"选择生日",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(M,{label:"星座"},{default:o(()=>[t(xe,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=s=>S.value=s),placeholder:"请选择星座"},{default:o(()=>[(i(!0),d(Q,null,W(re.value,s=>(i(),A(Se,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(M,{label:"签名"},{default:o(()=>[t(F,{modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=s=>U.value=s),type:"textarea",rows:4,placeholder:"介绍一下自己吧..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):y("",!0),x.value==="securitys"?(i(),d("div",dl,[t(te,{class:"form-card danger-zone"},{header:o(()=>e[19]||(e[19]=[l("div",{class:"card-header"},[l("h2",{class:"card-title"},"账号操作")],-1)])),default:o(()=>[l("div",cl,[l("div",vl,[e[21]||(e[21]=l("div",{class:"action-info"},[l("h4",null,"退出登录"),l("p",null,"退出当前账号的登录状态")],-1)),t(se,{onClick:he},{default:o(()=>e[20]||(e[20]=[I("退出账号")])),_:1})]),l("div",ml,[e[23]||(e[23]=l("div",{class:"action-info"},[l("h4",null,"注销账号"),l("p",null," 永久删除你的账号和所有数据，此操作不可恢复，请谨慎操作。 ")],-1)),t(se,{type:"danger",onClick:ke},{default:o(()=>e[22]||(e[22]=[I("注销账号")])),_:1})])])]),_:1})])):y("",!0),x.value==="likes"?(i(),d("div",pl,[e[25]||(e[25]=l("h2",{class:"like-title"},"我的点赞",-1)),f(E).length>0?(i(),d("div",fl,[(i(!0),d(Q,null,W(f(E),s=>(i(),d("div",{class:"like-item",key:s.id},[t(n,{class:"like-icon"},{default:o(()=>[t(f(ie))]),_:1}),l("div",null,[G(l("img",_l,null,512),[[oe,s.image]]),l("div",yl,[l("h3",gl,D(s.title),1),l("p",kl,D(s.content),1),l("div",bl,[l("span",hl,D(s.label),1)])])])]))),128))])):(i(),d("div",Cl,e[24]||(e[24]=[l("p",null,[I(" 你还没有点赞任何文章。"),l("br"),I(" 你可以在首页添加文章，并在个人分享中对文章进行点赞，以便在这里查看你的点赞记录。"),l("br")],-1)])))])):y("",!0),x.value==="modes"?(i(),d("div",Vl,[e[29]||(e[29]=l("h2",{class:"mode-title"},"模式选择",-1)),e[30]||(e[30]=l("p",{class:"mode-description"},"模式切换",-1)),l("div",wl,[l("div",Ul,[e[26]||(e[26]=l("span",{class:"mode-label"},"夜间模式跟随系统",-1)),l("div",Sl,[t(Y,{modelValue:$.value,"onUpdate:modelValue":e[8]||(e[8]=s=>$.value=s),"active-color":"#13ce66","inactive-color":"#ff4949",onChange:e[9]||(e[9]=s=>f(z)($.value?"system":"light"))},null,8,["modelValue"])])]),$.value?y("",!0):(i(),d("div",xl,[e[27]||(e[27]=l("span",{class:"mode-label"},"日间模式",-1)),l("div",Il,[t(n,{class:q(["check-icon",{primary:ee.value}]),onClick:e[10]||(e[10]=s=>f(z)("light"))},{default:o(()=>[ee.value?(i(),A(f(ne),{key:0})):y("",!0)]),_:1},8,["class"])])])),$.value?y("",!0):(i(),d("div",Ol,[e[28]||(e[28]=l("span",{class:"mode-label"},"夜间模式",-1)),l("div",Tl,[t(n,{class:q(["check-icon",{primary:le.value}]),onClick:e[11]||(e[11]=s=>f(z)("dark"))},{default:o(()=>[le.value?(i(),A(f(ne),{key:0})):y("",!0)]),_:1},8,["class"])])]))])])):y("",!0),x.value==="layouts"?(i(),d("div",Ml,[e[33]||(e[33]=l("h2",{class:"layout-title"},"布局设置",-1)),e[34]||(e[34]=l("p",{class:"layout-description"},"选择你的侧边栏设置",-1)),l("div",Al,[l("div",Bl,[e[31]||(e[31]=l("span",{class:"layout-label"},"一刻时光",-1)),t(Y,{"active-color":"#13ce66","inactive-color":"#ff4949"})]),l("div",$l,[e[32]||(e[32]=l("span",{class:"layout-label"},"建议与反馈",-1)),t(Y,{"active-color":"#13ce66","inactive-color":"#ff4949"})])])])):y("",!0)])])])])}}}),jl=Ge(Dl,[["__scopeId","data-v-6e9d6b9c"]]);export{jl as default};
