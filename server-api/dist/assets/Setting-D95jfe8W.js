import{a as t,d as Me,u as Ae,b as Fe,P as B,e as i,a2 as $e,A as ze,c as d,f as l,y as M,w as s,h as x,N as Be,t as G,O as De,U as J,V as W,k as $,z as _,m as I,a1 as q,M as Le,n as A,E as c,Y as Q,r as v,i as Ne,T as Pe,o as n,_ as je,a0 as Ee,a6 as ie,a7 as He,a8 as Re,a9 as Ye,aa as Ge,p as ue}from"./index-BDg1WjkS.js";import{I as Je,H as re}from"./HeartOutlined-4517EROV.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";var qe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-696 72h136v656H184V184zm656 656H384V384h456v456zM384 320V184h456v136H384z"}}]},name:"layout",theme:"outlined"};function de(g){for(var r=1;r<arguments.length;r++){var m=arguments[r]!=null?Object(arguments[r]):{},y=Object.keys(m);typeof Object.getOwnPropertySymbols=="function"&&(y=y.concat(Object.getOwnPropertySymbols(m).filter(function(p){return Object.getOwnPropertyDescriptor(m,p).enumerable}))),y.forEach(function(p){Qe(g,p,m[p])})}return g}function Qe(g,r,m){return r in g?Object.defineProperty(g,r,{value:m,enumerable:!0,configurable:!0,writable:!0}):g[r]=m,g}var X=function(r,m){var y=de({},r,m.attrs);return t(Je,de({},y,{icon:qe}),null)};X.displayName="LayoutOutlined";X.inheritAttrs=!1;const Xe=[{label:"白羊座",value:"白羊座"},{label:"金牛座",value:"金牛座"},{label:"双子座",value:"双子座"},{label:"巨蟹座",value:"巨蟹座"},{label:"狮子座",value:"狮子座"},{label:"处女座",value:"处女座"},{label:"天秤座",value:"天秤座"},{label:"天蝎座",value:"天蝎座"},{label:"射手座",value:"射手座"},{label:"摩羯座",value:"摩羯座"},{label:"水瓶座",value:"水瓶座"},{label:"双鱼座",value:"双鱼座"}],Ze={class:"settings-page"},Ke={class:"settings-wrapper"},el={class:"page-title"},ll={class:"settings-layout"},al={class:"settings-nav"},tl={class:"profile-card"},ol={class:"avatar-container"},sl={key:0,class:"avatar"},nl={class:"avatar-mask"},il={class:"chose-nickname-color"},ul={class:"nav-menu"},rl=["onClick"],dl={class:"settings-main"},cl={class:"card-header"},vl={key:1},ml={class:"danger-actions"},pl={class:"action-item"},fl={class:"action-item"},_l={key:2,class:"like-section"},yl={key:0},gl={class:"like-image"},kl={class:"like-content"},bl={class:"like-title"},hl={class:"like-description"},Cl={class:"like-tags"},Vl={class:"like-tag"},wl={key:1,class:"empty-state"},Ul={key:3,class:"mode-section"},Sl={class:"mode-toggles"},xl={class:"mode-item"},Il={class:"mode-toggle"},Tl={key:0,class:"mode-item"},Ol={class:"mode-toggle"},Ml={key:1,class:"mode-item"},Al={class:"mode-toggle"},Fl={key:4,class:"layout-section"},$l={class:"layout-options"},zl={class:"layout-item"},Bl={class:"layout-item"},Dl=Me({__name:"Setting",setup(g){const r=Le(),m=Ne(),y=Ae(),p=Fe(),{currentTheme:Ll,toggleTheme:D,handleSystemThemeChange:Nl,setTheme:Pl}=p,Z=B(()=>p.currentThemeMode==="light"),K=B(()=>p.currentThemeMode==="dark"),F=B({get:()=>p.followSystem,set:o=>{o?p.toggleTheme("system"):p.toggleTheme("light")}}),ee=i(!0),le=i(!0),L=i(!1),k=i(""),V=i("0"),w=i(""),U=i(""),f=i(""),N=i(!1),S=i(""),P=i(null),ce=i(Xe.map(o=>({value:o.value,label:o.label}))),b=i("#000000"),j=i([]),ve=i(""),h=i(Array.isArray(r.params.tab)?r.params.tab[0]:r.params.tab||"personal"),T=i(null),E=i(null),C=i({nickname:"",sex:"0",birthday:"",introduce:"",avatar:"",constellation:"",nicknameColor:""}),ae=[{id:"personals",title:"我的资料",icon:He},{id:"securitys",title:"账号安全",icon:Re},{id:"likes",title:"我的点赞",icon:re},{id:"modes",title:"模式选择",icon:Ye},{id:"layouts",title:"界面布局",icon:X}],me=B(()=>{const o=ae.find(e=>e.id===h.value);return o?o.title:"我的资料"}),pe=()=>{E.value.submit()},fe=(o,e)=>{N.value=e.length>0},_e=o=>{h.value=o,m.push({name:"Setting",params:{tab:o}})};$e(()=>r.params.tab,o=>{h.value=Array.isArray(o)?o[0]:o||"personal"});const ye=async()=>{try{const e=(await A.get("/users/me")).data.data;k.value=e.nickname||"",V.value=e.sex.toString()||"0",w.value=new Date(e.birthday).toISOString().slice(0,10)||"",U.value=e.introduce||"",f.value=e.avatar||"",T.value=e.id,S.value=e.constellation||"",P.value=e.clientFeatureCode||null,b.value=e.nicknameColor||"#000000",p.user=e.id.toString(),C.value={nickname:k.value,sex:V.value,birthday:w.value,introduce:U.value,avatar:f.value,constellation:S.value,nicknameColor:b.value}}catch{c.error("获取用户信息失败,请重新登录再试")}},ge=o=>{const u=["image/jpeg","image/png","image/webp","image/jfif"].includes(o.type),H=o.size/1024/1024<2;return u?H?T.value?(f.value&&te(),!0):(c.error("ID未找到，请重新登录"),!1):(c.error("上传头像图片大小不能超过 2MB!"),!1):(c.error("上传图片只能是 JPG 或 PNG 或 WEBP 或 JFIF 格式!"),!1)},te=async()=>{try{const e=new URL(f.value).pathname.split("/").pop();await A.delete(`${Q}/admin/uploadavatar/avatar/${e}`),c.info("旧头像已删除,已重新上传新头像")}catch(o){console.error("删除旧头像失败:",o),c.error("删除旧头像失败")}},ke=(o,e)=>{f.value=`${Q}/avatar/${o.data.avatar}`,c.success("头像上传成功"),E.value.clearFiles(),N.value=!1},be=async()=>{if(k.value===C.value.nickname&&V.value===C.value.sex&&w.value===C.value.birthday&&U.value===C.value.introduce&&f.value===C.value.avatar&&S.value===C.value.constellation&&b.value===C.value.nicknameColor){c.info("没有发现任何更改,请修改后再来保存");return}try{const e=(await A.put("/users/info",{nickname:k.value,sex:parseInt(V.value,10),birthday:w.value,introduce:U.value,avatar:f.value,constellation:S.value,nicknameColor:b.value})).data.data;k.value=e.nickname||"",V.value=e.sex.toString()||"0",w.value=e.birthday||"",U.value=e.introduce||"",f.value=e.avatar||ve.value,S.value=e.constellation||"",b.value=e.nicknameColor||"#000000",y.setUser(e),C.value={nickname:k.value,sex:V.value,birthday:w.value,introduce:U.value,avatar:f.value,constellation:S.value,nicknameColor:b.value},c.success("更新信息成功")}catch{c.error("更新信息失败")}},he=async()=>{try{await Ge.confirm("您确定要注销账号吗？您的所有资源将被删除。请谨慎操作。","确认注销",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.deleteAllUserImages(),await A.delete("/users/resources",{data:{userId:T.value}}),f.value&&(await te(),c.success("头像删除成功")),localStorage.removeItem(`theme-${T.value}`),await A.delete("/users/delete"),ue.remove("token"),y.clearUser(),p.clearUserTheme(),c.success("账号已注销"),m.push({name:"login"})}catch(o){o!=="cancel"&&c.error("注销失败，请稍后再试")}},Ce=async()=>{try{if(!T.value){c.error("用户ID获取失败");return}const e=(await A.get("/admin/article",{params:{userId:T.value}})).data.data.articles;j.value=e.filter(u=>u.likesCount===1).map(u=>({id:u.id,title:u.title,content:u.content,image:u.image,likesCount:u.likesCount,label:u.label}))}catch{c.error("获取点赞文章数据失败，请稍后再试")}},Ve=()=>{ue.remove("token"),y.clearUser(),m.push({name:"login"})};return ze(()=>{ye().then(()=>{Ce()})}),(o,e)=>{const u=v("el-icon"),H=v("el-upload"),z=v("el-input"),we=v("Upload"),Ue=v("SuccessFilled"),O=v("el-form-item"),R=v("el-radio"),Se=v("el-radio-group"),xe=v("el-date-picker"),Ie=v("el-option"),Te=v("el-select"),oe=v("el-card"),Oe=v("el-form"),se=v("el-button"),Y=v("el-switch"),ne=Pe("lazy");return n(),d("div",Ze,[l("div",Ke,[l("h1",el,M(me.value),1),l("div",ll,[l("div",al,[l("div",tl,[t(H,{class:"avatar-uploader",action:`${x(Q)}/admin/uploadavatar`,"show-file-list":!1,"before-upload":ge,"on-success":ke,method:"post",data:{userId:T.value},name:"avatar","auto-upload":!1,ref_key:"uploadRef",ref:E,onChange:fe},{default:s(()=>[l("div",ol,[f.value?G((n(),d("img",sl,null,512)),[[ne,f.value]]):_("",!0),l("div",nl,[t(u,null,{default:s(()=>[t(x(je))]),_:1}),e[14]||(e[14]=l("span",null,"更换头像",-1))])])]),_:1},8,["action","data"]),l("h3",{style:Be({color:b.value}),class:"profile-name"},M(k.value||"设置昵称"),5),G(l("div",il,[t(z,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),class:"nickname-color-input",type:"color",placeholder:"选择颜色"},null,8,["modelValue"])],512),[[De,L.value]]),l("div",{class:"nickname-color-label",onClick:e[1]||(e[1]=a=>L.value=!L.value)}," 修改我的昵称颜色 ")]),l("div",ul,[(n(),d(J,null,W(ae,a=>l("div",{key:a.id,class:q(["nav-item",{active:h.value===a.id}]),onClick:jl=>_e(a.id)},[t(u,null,{default:s(()=>[(n(),$(Ee(a.icon)))]),_:2},1024),I(" "+M(a.title),1)],10,rl)),64))])]),l("div",dl,[h.value==="personals"?(n(),$(Oe,{key:0,class:"settings-form","label-position":"top"},{default:s(()=>[t(oe,{class:"form-card"},{header:s(()=>[l("div",cl,[e[17]||(e[17]=l("h2",{class:"card-title"},"基本信息",-1)),N.value?(n(),d("div",{key:0,style:{position:"fixed",right:"370px"},class:"avatar-upload",onClick:pe},[t(u,null,{default:s(()=>[t(we)]),_:1}),e[15]||(e[15]=l("span",null,"上传头像",-1))])):_("",!0),l("div",{type:"primary",class:"avatar-upload","native-type":"submit",onClick:be},[t(u,null,{default:s(()=>[t(Ue)]),_:1}),e[16]||(e[16]=l("span",null,"保存更改",-1))])])]),default:s(()=>[t(O,{label:"昵称"},{default:s(()=>[t(z,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),t(O,{label:"特征码 (用于校验客户端安全性，注册后不可修改)","label-style":{color:"#FFCCCC"}},{default:s(()=>[t(z,{modelValue:P.value,"onUpdate:modelValue":e[3]||(e[3]=a=>P.value=a),disabled:!0},null,8,["modelValue"])]),_:1}),t(O,{label:"性别"},{default:s(()=>[t(Se,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=a=>V.value=a)},{default:s(()=>[t(R,{label:"1"},{default:s(()=>e[18]||(e[18]=[I("男")])),_:1}),t(R,{label:"2"},{default:s(()=>e[19]||(e[19]=[I("女")])),_:1}),t(R,{label:"0"},{default:s(()=>e[20]||(e[20]=[I("保密")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(O,{label:"生日"},{default:s(()=>[t(xe,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),type:"date",placeholder:"选择生日",format:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(O,{label:"星座"},{default:s(()=>[t(Te,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=a=>S.value=a),placeholder:"请选择星座"},{default:s(()=>[(n(!0),d(J,null,W(ce.value,a=>(n(),$(Ie,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(O,{label:"个性签名"},{default:s(()=>[t(z,{modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=a=>U.value=a),type:"textarea",rows:4,placeholder:"介绍一下自己吧..."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):_("",!0),h.value==="securitys"?(n(),d("div",vl,[t(oe,{class:"form-card danger-zone"},{header:s(()=>e[21]||(e[21]=[l("div",{class:"card-header"},[l("h2",{class:"card-title"},"账号操作")],-1)])),default:s(()=>[l("div",ml,[l("div",pl,[e[23]||(e[23]=l("div",{class:"action-info"},[l("h4",null,"退出登录"),l("p",null,"退出当前账号的登录状态")],-1)),t(se,{onClick:Ve},{default:s(()=>e[22]||(e[22]=[I("退出账号")])),_:1})]),l("div",fl,[e[25]||(e[25]=l("div",{class:"action-info"},[l("h4",null,"注销账号"),l("p",null," 永久删除你的账号和所有数据，此操作不可恢复，请谨慎操作。 ")],-1)),t(se,{type:"danger",onClick:he},{default:s(()=>e[24]||(e[24]=[I("注销账号")])),_:1})])])]),_:1})])):_("",!0),h.value==="likes"?(n(),d("div",_l,[e[27]||(e[27]=l("h2",{class:"like-title"},"我的点赞",-1)),j.value.length>0?(n(),d("div",yl,[(n(!0),d(J,null,W(j.value,a=>(n(),d("div",{class:"like-item",key:a.id},[t(u,{class:"like-icon"},{default:s(()=>[t(x(re))]),_:1}),l("div",null,[G(l("img",gl,null,512),[[ne,a.image]]),l("div",kl,[l("h3",bl,M(a.title),1),l("p",hl,M(a.content),1),l("div",Cl,[l("span",Vl,M(a.label),1)])])])]))),128))])):(n(),d("div",wl,e[26]||(e[26]=[l("p",null,[I(" 你还没有点赞任何文章。"),l("br"),I(" 你可以在首页添加文章，并在个人分享中对文章进行点赞，以便在这里查看你的点赞记录。"),l("br")],-1)])))])):_("",!0),h.value==="modes"?(n(),d("div",Ul,[e[31]||(e[31]=l("h2",{class:"mode-title"},"模式选择",-1)),e[32]||(e[32]=l("p",{class:"mode-description"},"模式切换",-1)),l("div",Sl,[l("div",xl,[e[28]||(e[28]=l("span",{class:"mode-label"},"夜间模式跟随系统",-1)),l("div",Il,[t(Y,{modelValue:F.value,"onUpdate:modelValue":e[8]||(e[8]=a=>F.value=a),"active-color":"#13ce66","inactive-color":"#ff4949",onChange:e[9]||(e[9]=a=>x(D)(F.value?"system":"light"))},null,8,["modelValue"])])]),F.value?_("",!0):(n(),d("div",Tl,[e[29]||(e[29]=l("span",{class:"mode-label"},"日间模式",-1)),l("div",Ol,[t(u,{class:q(["check-icon",{primary:Z.value}]),onClick:e[10]||(e[10]=a=>x(D)("light"))},{default:s(()=>[Z.value?(n(),$(x(ie),{key:0})):_("",!0)]),_:1},8,["class"])])])),F.value?_("",!0):(n(),d("div",Ml,[e[30]||(e[30]=l("span",{class:"mode-label"},"夜间模式",-1)),l("div",Al,[t(u,{class:q(["check-icon",{primary:K.value}]),onClick:e[11]||(e[11]=a=>x(D)("dark"))},{default:s(()=>[K.value?(n(),$(x(ie),{key:0})):_("",!0)]),_:1},8,["class"])])]))])])):_("",!0),h.value==="layouts"?(n(),d("div",Fl,[e[35]||(e[35]=l("h2",{class:"layout-title"},"布局设置",-1)),e[36]||(e[36]=l("p",{class:"layout-description"},"选择你的侧边栏设置",-1)),l("div",$l,[l("div",zl,[e[33]||(e[33]=l("span",{class:"layout-label"},"一刻时光",-1)),t(Y,{modelValue:le.value,"onUpdate:modelValue":e[12]||(e[12]=a=>le.value=a),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])]),l("div",Bl,[e[34]||(e[34]=l("span",{class:"layout-label"},"建议与反馈",-1)),t(Y,{modelValue:ee.value,"onUpdate:modelValue":e[13]||(e[13]=a=>ee.value=a),"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])])])])):_("",!0)])])])])}}}),Yl=We(Dl,[["__scopeId","data-v-cda02e37"]]);export{Yl as default};
